
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Analyzing the impact of the lockdown on air quality in Delhi, India &#8212; NumPy Tutorials</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing" href="../contributing.html" />
    <link rel="prev" title="Plotting Fractals" href="tutorial-plotting-fractals.html" />
  <meta name="robots" content="noindex" />
  
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/numpylogo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NumPy Tutorials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../features.html">
   NumPy Features
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-svd.html">
     Linear algebra on n-dimensional arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="save-load-arrays.html">
     Saving and sharing your NumPy arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-ma.html">
     Masked Arrays
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../applications.html">
   NumPy Applications
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="mooreslaw-tutorial.html">
     Determining Moore’s Law with real data in NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-deep-learning-on-mnist.html">
     Deep learning on MNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-deep-reinforcement-learning-with-pong-from-pixels.html">
     Deep reinforcement learning with Pong from pixels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-nlp-from-scratch.html">
     Sentiment Analysis on notable speeches of the last decade
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-x-ray-image-processing.html">
     X-ray image processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-static_equilibrium.html">
     Determining Static Equilibrium in NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-plotting-fractals.html">
     Plotting Fractals
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Analyzing the impact of the lockdown on air quality in Delhi, India
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="pairing.html">
     Pairing Jupyter notebooks and MyST-NB
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tutorial-style-guide.html">
     Learn to write a NumPy tutorial
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/numpy/numpy-tutorials/main?urlpath=tree/site/content/tutorial-air-quality-analysis.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/numpy/numpy-tutorials/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/numpy/numpy-tutorials//issues/new?title=Issue%20on%20page%20%2Fcontent/tutorial-air-quality-analysis.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/numpy/numpy-tutorials/edit/main/site/content/tutorial-air-quality-analysis.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/content/tutorial-air-quality-analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/content/tutorial-air-quality-analysis.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-do">
   What you’ll do
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-learn">
   What you’ll learn
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-need">
   What you’ll need
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem-of-air-pollution">
   The problem of air pollution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-the-dataset">
   Building the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculating-the-air-quality-index">
   Calculating the Air Quality Index
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#moving-averages">
     Moving averages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-indices">
     Sub-indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#air-quality-indices">
     Air quality indices
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#paired-student-s-t-test-on-the-aqis">
   Paired Student’s t-test on the AQIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling">
     Sampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-the-hypothesis">
     Defining the hypothesis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-the-test-statistics">
     Calculating the test statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-do-the-t-and-p-values-mean">
   What do the
   <code class="docutils literal notranslate">
    <span class="pre">
     t
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     p
    </span>
   </code>
   values mean?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#in-practice">
   In practice…
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#further-reading">
   Further reading
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Analyzing the impact of the lockdown on air quality in Delhi, India</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-do">
   What you’ll do
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-learn">
   What you’ll learn
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-you-ll-need">
   What you’ll need
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem-of-air-pollution">
   The problem of air pollution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-the-dataset">
   Building the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculating-the-air-quality-index">
   Calculating the Air Quality Index
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#moving-averages">
     Moving averages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-indices">
     Sub-indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#air-quality-indices">
     Air quality indices
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#paired-student-s-t-test-on-the-aqis">
   Paired Student’s t-test on the AQIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling">
     Sampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-the-hypothesis">
     Defining the hypothesis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-the-test-statistics">
     Calculating the test statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-do-the-t-and-p-values-mean">
   What do the
   <code class="docutils literal notranslate">
    <span class="pre">
     t
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     p
    </span>
   </code>
   values mean?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#in-practice">
   In practice…
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#further-reading">
   Further reading
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="analyzing-the-impact-of-the-lockdown-on-air-quality-in-delhi-india">
<h1>Analyzing the impact of the lockdown on air quality in Delhi, India<a class="headerlink" href="#analyzing-the-impact-of-the-lockdown-on-air-quality-in-delhi-india" title="Permalink to this headline">#</a></h1>
<p><img alt="A grid showing the India Gate in smog above and clear air below" src="../_images/11-delhi-aqi.jpg" /></p>
<section id="what-you-ll-do">
<h2>What you’ll do<a class="headerlink" href="#what-you-ll-do" title="Permalink to this headline">#</a></h2>
<p>Calculate Air Quality Indices (AQI) and perform paired Student’s t-test on them.</p>
</section>
<section id="what-you-ll-learn">
<h2>What you’ll learn<a class="headerlink" href="#what-you-ll-learn" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>You’ll learn the concept of moving averages</p></li>
<li><p>You’ll learn how to calculate Air Quality Index (AQI)</p></li>
<li><p>You’ll learn how to perform a paired Student’s t-test and find the <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">p</span></code> values</p></li>
<li><p>You’ll learn how to interpret these values</p></li>
</ul>
</section>
<section id="what-you-ll-need">
<h2>What you’ll need<a class="headerlink" href="#what-you-ll-need" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://scipy.org/install/">SciPy</a> installed in your environment</p></li>
<li><p>Basic understanding of statistical terms like population, sample, mean, standard deviation etc.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="the-problem-of-air-pollution">
<h2>The problem of air pollution<a class="headerlink" href="#the-problem-of-air-pollution" title="Permalink to this headline">#</a></h2>
<p>Air pollution is one of the most prominent types of pollution we face that has an immediate effect on our daily lives. The
COVID-19 pandemic resulted in lockdowns in different parts of the world; offering a rare opportunity to study the effect of
human activity (or lack thereof) on air pollution. In this tutorial, we will study the air quality in Delhi, one of the
worst affected cities by air pollution, before and during the lockdown from March to June 2020. For this, we will first compute
the Air Quality Index for each hour from the collected pollutant measurements. Next, we will sample these indices and perform
a <a class="reference external" href="https://en.wikipedia.org/wiki/Student%27s_t-test#Dependent_t-test_for_paired_samples">paired Student’s t-test</a> on them. It will statistically show us that the air quality improved due to the lockdown, supporting our intuition.</p>
<p>Let’s start by importing the necessary libraries into our environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="building-the-dataset">
<h2>Building the dataset<a class="headerlink" href="#building-the-dataset" title="Permalink to this headline">#</a></h2>
<p>We will use a condensed version of the <a class="reference external" href="https://www.kaggle.com/rohanrao/air-quality-data-in-india">Air Quality Data in India</a> dataset. This dataset contains air quality data and AQI (Air Quality Index) at hourly and daily level of various stations across multiple cities in India. The condensed version available with this tutorial contains hourly pollutant measurements for Delhi
from May 31, 2019 to June 30, 2020. It has measurements of the standard pollutants that are required for Air Quality Index calculation and a few other important ones:
Particulate Matter (PM 2.5 and PM 10), nitrogen dioxide (NO2), ammonia (NH3), sulfur dioxide (SO2), carbon monoxide (CO), ozone (O3), oxides of nitrogen (NOx), nitric oxide (NO), benzene, toluene, and xylene.</p>
<p>Let’s print out the first few rows to have a glimpse of our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> head air-quality-data.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datetime,PM2.5,PM10,NO2,NH3,SO2,CO,O3,NOx,NO,Benzene,Toluene,Xylene
2019-05-31 00:00:00,103.26,305.46,94.71,31.43,30.16,3.0,18.06,178.31,152.73,13.65,83.47,2.54
2019-05-31 01:00:00,104.47,309.14,74.66,34.08,27.02,1.69,18.65,106.5,79.98,11.35,76.79,2.91
2019-05-31 02:00:00,90.0,314.02,48.11,32.6,18.12,0.83,28.27,48.45,25.27,5.66,32.91,1.59
2019-05-31 03:00:00,78.01,356.14,45.45,30.21,16.78,0.79,27.47,44.22,21.5,3.6,21.41,0.78
2019-05-31 04:00:00,80.19,372.9,45.23,28.68,16.41,0.76,26.92,44.06,22.15,4.5,23.39,0.62
2019-05-31 05:00:00,83.59,389.97,39.49,27.71,17.42,0.76,28.71,39.33,21.04,3.25,23.59,0.56
2019-05-31 06:00:00,79.04,371.64,39.61,26.87,16.91,0.84,29.26,43.11,24.37,3.12,15.27,0.46
2019-05-31 07:00:00,77.32,361.88,42.63,27.26,17.86,0.96,27.07,48.22,28.81,3.32,14.42,0.41
2019-05-31 08:00:00,84.3,377.77,42.49,28.41,20.19,0.98,33.05,48.22,27.76,3.4,14.53,0.4
</pre></div>
</div>
</div>
</div>
<p>For the purpose of this tutorial, we are only concerned with standard pollutants required for calculating the AQI, viz., PM 2.5, PM 10, NO2, NH3, SO2, CO, and O3. So, we will only import these particular columns with <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.loadtxt.html">np.loadtxt</a>. We’ll then <a class="reference external" href="https://numpy.org/devdocs/glossary.html#term-0">slice</a> and create two sets: <code class="docutils literal notranslate"><span class="pre">pollutants_A</span></code> with PM 2.5, PM 10, NO2, NH3, and SO2, and <code class="docutils literal notranslate"><span class="pre">pollutants_B</span></code> with CO and O3. The
two sets will be processed slightly differently, as we’ll see later on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pollutant_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;air-quality-data.csv&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
                            <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">pollutants_A</span> <span class="o">=</span> <span class="n">pollutant_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">pollutants_B</span> <span class="o">=</span> <span class="n">pollutant_data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pollutants_A</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pollutants_B</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9528, 5)
(9528, 2)
</pre></div>
</div>
</div>
</div>
<p>Our dataset might contain missing values, denoted by <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, so let’s do a quick check with <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.isfinite.html">np.isfinite</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pollutant_data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>With this, we have successfully imported the data and checked that it is complete. Let’s move on to the AQI calculations!</p>
</section>
<section id="calculating-the-air-quality-index">
<h2>Calculating the Air Quality Index<a class="headerlink" href="#calculating-the-air-quality-index" title="Permalink to this headline">#</a></h2>
<p>We will calculate the AQI using <a class="reference external" href="https://app.cpcbccr.com/ccr_docs/FINAL-REPORT_AQI_.pdf">the method</a> adopted by the <a class="reference external" href="https://www.cpcb.nic.in/national-air-quality-index">Central Pollution Control Board</a> of India.  To summarize the steps:</p>
<ul>
<li><p>Collect 24-hourly average concentration values for the standard pollutants; 8-hourly in case of CO and O3.</p></li>
<li><p>Calculate the sub-indices for these pollutants with the formula:</p>
<div class="math notranslate nohighlight">
\[
    Ip = \dfrac{\text{IHi – ILo}}{\text{BPHi – BPLo}}\cdot{\text{Cp – BPLo}} + \text{ILo}
    \]</div>
<p>Where,</p>
<p><code class="docutils literal notranslate"><span class="pre">Ip</span></code> = sub-index of pollutant <code class="docutils literal notranslate"><span class="pre">p</span></code><br />
<code class="docutils literal notranslate"><span class="pre">Cp</span></code> = averaged concentration of pollutant <code class="docutils literal notranslate"><span class="pre">p</span></code><br />
<code class="docutils literal notranslate"><span class="pre">BPHi</span></code> = concentration breakpoint i.e. greater than or equal to <code class="docutils literal notranslate"><span class="pre">Cp</span></code><br />
<code class="docutils literal notranslate"><span class="pre">BPLo</span></code> = concentration breakpoint i.e. less than or equal to <code class="docutils literal notranslate"><span class="pre">Cp</span></code><br />
<code class="docutils literal notranslate"><span class="pre">IHi</span></code> = AQI value corresponding to <code class="docutils literal notranslate"><span class="pre">BPHi</span></code><br />
<code class="docutils literal notranslate"><span class="pre">ILo</span></code> = AQI value corresponding to <code class="docutils literal notranslate"><span class="pre">BPLo</span></code></p>
</li>
<li><p>The maximum sub-index at any given time is the Air Quality Index.</p></li>
</ul>
<p>The Air Quality Index is calculated with the help of breakpoint ranges as shown in the chart below.</p>
<p><img alt="Chart of the breakpoint ranges" src="../_images/11-breakpoints.png" /></p>
<p>Let’s create two arrays to store the AQI ranges and breakpoints so that we can use them later for our calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AQI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">501</span><span class="p">])</span>

<span class="n">breakpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;PM2.5&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">251</span><span class="p">]),</span>
    <span class="s1">&#39;PM10&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">431</span><span class="p">]),</span>
    <span class="s1">&#39;NO2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">281</span><span class="p">,</span> <span class="mi">401</span><span class="p">]),</span>
    <span class="s1">&#39;NH3&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">801</span><span class="p">,</span> <span class="mi">1201</span><span class="p">,</span> <span class="mi">1801</span><span class="p">]),</span>
    <span class="s1">&#39;SO2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">381</span><span class="p">,</span> <span class="mi">801</span><span class="p">,</span> <span class="mi">1601</span><span class="p">]),</span>
    <span class="s1">&#39;CO&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">17.1</span><span class="p">,</span> <span class="mi">35</span><span class="p">]),</span>
    <span class="s1">&#39;O3&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">749</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="moving-averages">
<h3>Moving averages<a class="headerlink" href="#moving-averages" title="Permalink to this headline">#</a></h3>
<p>For the first step, we have to compute <a class="reference external" href="https://en.wikipedia.org/wiki/Moving_average">moving averages</a> for <code class="docutils literal notranslate"><span class="pre">pollutants_A</span></code> over a window of 24 hours and <code class="docutils literal notranslate"><span class="pre">pollutants_B</span></code> over a
window of 8 hours. We will write a simple function <code class="docutils literal notranslate"><span class="pre">moving_mean</span></code> using <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.cumsum.html">np.cumsum</a> and <a class="reference external" href="https://numpy.org/devdocs/user/basics.indexing.html#slicing-and-striding">sliced indexing</a> to achieve this.</p>
<p>To make sure both the sets are of the same length, we will truncate the <code class="docutils literal notranslate"><span class="pre">pollutants_B_8hr_avg</span></code> according to the length of
<code class="docutils literal notranslate"><span class="pre">pollutants_A_24hr_avg</span></code>. This will also ensure we have concentrations for all the pollutants over the same period of time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">moving_mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ret</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">n</span>

<span class="n">pollutants_A_24hr_avg</span> <span class="o">=</span> <span class="n">moving_mean</span><span class="p">(</span><span class="n">pollutants_A</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">pollutants_B_8hr_avg</span> <span class="o">=</span> <span class="n">moving_mean</span><span class="p">(</span><span class="n">pollutants_B</span><span class="p">,</span> <span class="mi">8</span><span class="p">)[</span><span class="o">-</span><span class="p">(</span><span class="n">pollutants_A_24hr_avg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can join both sets with <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.concatenate.html">np.concatenate</a> to form a single data set of all the averaged concentrations. Note that we have to join our arrays column-wise so we pass the
<code class="docutils literal notranslate"><span class="pre">axis=1</span></code> parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pollutants</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pollutants_A_24hr_avg</span><span class="p">,</span> <span class="n">pollutants_B_8hr_avg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sub-indices">
<h3>Sub-indices<a class="headerlink" href="#sub-indices" title="Permalink to this headline">#</a></h3>
<p>The subindices for each pollutant are calculated according to the linear relationship between the AQI and standard breakpoint ranges with the formula as above:</p>
<div class="math notranslate nohighlight">
\[
Ip = \dfrac{\text{IHi – ILo}}{\text{BPHi – BPLo}}\cdot{\text{Cp – BPLo}} + \text{ILo}
\]</div>
<p>The <code class="docutils literal notranslate"><span class="pre">compute_indices</span></code> function first fetches the correct upper and lower bounds of AQI categories and breakpoint concentrations for the input concentration and pollutant with the help of arrays <code class="docutils literal notranslate"><span class="pre">AQI</span></code> and <code class="docutils literal notranslate"><span class="pre">breakpoints</span></code> we created above. Then, it feeds these values into the formula to calculate the sub-index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_indices</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">con</span><span class="p">):</span>
    <span class="n">bp</span> <span class="o">=</span> <span class="n">breakpoints</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;CO&#39;</span><span class="p">:</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">bp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span> <span class="o">&lt;</span> <span class="n">bp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">bp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span> <span class="o">&lt;</span> <span class="n">bp</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">bp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span> <span class="o">&lt;</span> <span class="n">bp</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">bp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span> <span class="o">&lt;</span> <span class="n">bp</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">bp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span> <span class="o">&lt;</span> <span class="n">bp</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">bp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">con</span><span class="p">:</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">bp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">inc</span><span class="p">)</span>
        <span class="n">Ih</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">Il</span> <span class="o">=</span> <span class="n">AQI</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Concentration out of range!&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="p">((</span><span class="n">Ih</span> <span class="o">-</span> <span class="n">Il</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bh</span> <span class="o">-</span> <span class="n">Bl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span> <span class="o">-</span> <span class="n">Bl</span><span class="p">)</span> <span class="o">+</span> <span class="n">Il</span>
</pre></div>
</div>
</div>
</div>
<p>We will use <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.vectorize.html">np.vectorize</a> to utilize the concept of vectorization. This simply means we don’t have loop over each element of the pollutant array ourselves. <a class="reference external" href="https://numpy.org/devdocs/user/whatisnumpy.html#why-is-numpy-fast">Vectorization</a> is one of the key advantages of NumPy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vcompute_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">compute_indices</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By calling our vectorized function <code class="docutils literal notranslate"><span class="pre">vcompute_indices</span></code> for each pollutant, we get the sub-indices. To get back an array with the original shape, we use <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.stack.html">np.stack</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;PM2.5&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;PM10&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;NO2&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;NH3&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;SO2&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
                        <span class="n">vcompute_indices</span><span class="p">(</span><span class="s1">&#39;O3&#39;</span><span class="p">,</span> <span class="n">pollutants</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="air-quality-indices">
<h3>Air quality indices<a class="headerlink" href="#air-quality-indices" title="Permalink to this headline">#</a></h3>
<p>Using <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.maximum.html">np.max</a>, we find out the maximum sub-index for each period, which is our Air Quality Index!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aqi_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sub_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we have the AQI for every hour from June 1, 2019 to June 30, 2020. Note that even though we started out with
the data from 31st May, we truncated that during the moving averages step.</p>
</section>
</section>
<section id="paired-student-s-t-test-on-the-aqis">
<h2>Paired Student’s t-test on the AQIs<a class="headerlink" href="#paired-student-s-t-test-on-the-aqis" title="Permalink to this headline">#</a></h2>
<p>Hypothesis testing is a form of descriptive statistics used to help us make decisions with the data. From the calculated AQI data, we want to find out if there was a statistically significant difference in average AQI before and after the lockdown was imposed. We will use the left-tailed, <a class="reference external" href="https://en.wikipedia.org/wiki/Student%27s_t-test#Dependent_t-test_for_paired_samples">paired Student’s t-test</a> to compute two test statistics- the <a class="reference external" href="https://en.wikipedia.org/wiki/T-statistic"><code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">statistic</span></code></a> and the <a class="reference external" href="https://en.wikipedia.org/wiki/P-value"><code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">value</span></code></a>. We will then compare these with the corresponding critical values to make a decision.</p>
<p><img alt="Normal distribution plot showing area of rejection in one-tailed test (left tailed)" src="../_images/11-one-tailed-test.svg" /></p>
<section id="sampling">
<h3>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">#</a></h3>
<p>We will now import the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> column from our original dataset into a <a class="reference external" href="https://numpy.org/devdocs/reference/arrays.scalars.html"><em>datetime64</em> dtype</a> array. We will use this array to index the AQI array and obtain subsets of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datetime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;air-quality-data.csv&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[h]&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
                         <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">))[</span><span class="o">-</span><span class="p">(</span><span class="n">pollutants_A_24hr_avg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>
</pre></div>
</div>
</div>
</div>
<p>Since total lockdown commenced in Delhi from March 24, 2020, the after-lockdown subset is of the period March 24, 2020 to June 30, 2020. The before-lockdown subset is for the same length of time before 24th March.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">after_lock</span> <span class="o">=</span> <span class="n">aqi_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">datetime</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2020-03-24T00&#39;</span><span class="p">))]</span>

<span class="n">before_lock</span> <span class="o">=</span> <span class="n">aqi_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">datetime</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2020-03-21T00&#39;</span><span class="p">))][</span><span class="o">-</span><span class="p">(</span><span class="n">after_lock</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">after_lock</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">before_lock</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2376,)
(2376,)
</pre></div>
</div>
</div>
</div>
<p>To make sure our samples are <em>approximately</em> normally distributed, we take samples of size <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">30</span></code>. <code class="docutils literal notranslate"><span class="pre">before_sample</span></code> and <code class="docutils literal notranslate"><span class="pre">after_sample</span></code> are the set of random observations drawn before and after the total lockdown. We use <a class="reference external" href="https://numpy.org/devdocs/reference/random/generated/numpy.random.Generator.choice.html">random.Generator.choice</a> to generate the samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>

<span class="n">before_sample</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">before_lock</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">after_sample</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">after_lock</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-the-hypothesis">
<h3>Defining the hypothesis<a class="headerlink" href="#defining-the-hypothesis" title="Permalink to this headline">#</a></h3>
<p>Let us assume that there is no significant difference between the sample means before and after the lockdown. This will be the null hypothesis. The alternative hypothesis would be that there <em>is</em> a significant difference between the means and the AQI <em>improved</em>. Mathematically,</p>
<p><span class="math notranslate nohighlight">\(H_{0}: \mu_\text{after-before} = 0\)</span> <br />
<span class="math notranslate nohighlight">\(H_{a}: \mu_\text{after-before} &lt; 0\)</span></p>
</section>
<section id="calculating-the-test-statistics">
<h3>Calculating the test statistics<a class="headerlink" href="#calculating-the-test-statistics" title="Permalink to this headline">#</a></h3>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">t</span></code> statistic to evaluate our hypothesis and even calculate the <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">value</span></code> from it. The formula for the <code class="docutils literal notranslate"><span class="pre">t</span></code> statistic is:</p>
<div class="math notranslate nohighlight">
\[
t = \frac{\mu_\text{after-before}}{\sqrt{\sigma^{2}/n}}
\]</div>
<p>where,</p>
<p><span class="math notranslate nohighlight">\(\mu_\text{after-before}\)</span> = mean differences of samples <br />
<span class="math notranslate nohighlight">\(\sigma^{2}\)</span> = variance of mean differences <br />
<span class="math notranslate nohighlight">\(n\)</span> = sample size</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">t_test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">denom</span><span class="p">)</span>

<span class="n">t_value</span> <span class="o">=</span> <span class="n">t_test</span><span class="p">(</span><span class="n">before_sample</span><span class="p">,</span> <span class="n">after_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">p</span></code> value, we will use SciPy’s <code class="docutils literal notranslate"><span class="pre">stats.distributions.t.cdf()</span></code> function. It takes two arguments- the <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">statistic</span></code> and the degrees of freedom (<code class="docutils literal notranslate"><span class="pre">dof</span></code>). The formula for <code class="docutils literal notranslate"><span class="pre">dof</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">-</span> <span class="pre">1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">before_sample</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t_value</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The t value is </span><span class="si">{}</span><span class="s2"> and the p value is </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The t value is -7.1907427482282325 and the p value is 3.2335062651343254e-08.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="what-do-the-t-and-p-values-mean">
<h2>What do the <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">p</span></code> values mean?<a class="headerlink" href="#what-do-the-t-and-p-values-mean" title="Permalink to this headline">#</a></h2>
<p>We will now compare the calculated test statistics with the critical test statistics. The critical <code class="docutils literal notranslate"><span class="pre">t</span></code> value is calculated by looking up the <a class="reference external" href="https://en.wikipedia.org/wiki/Student%27s_t-distribution#Table_of_selected_values">t-distribution table</a>.</p>
<p><img alt="Table of selected t values at different confidence levels. T value for 29 dof at 95% confidence level is highlighted with a yellow square" src="../_images/11-t-table.png" /></p>
<p>From the table above, the critical value is 1.699 for 29 <code class="docutils literal notranslate"><span class="pre">dof</span></code> at a confidence level of 95%. Since we are using the left tailed test, our critical value is -1.699. Clearly, the calculated <code class="docutils literal notranslate"><span class="pre">t</span></code> value is less than the critical value so we can safely reject the null hypothesis.</p>
<p>The critical <code class="docutils literal notranslate"><span class="pre">p</span></code> value, denoted by <span class="math notranslate nohighlight">\(\alpha\)</span>, is usually chosen to be 0.05, corresponding to a confidence level of 95%. If the calculated <code class="docutils literal notranslate"><span class="pre">p</span></code> value is less than <span class="math notranslate nohighlight">\(\alpha\)</span>, then the null hypothesis can be safely rejected. Clearly, our <code class="docutils literal notranslate"><span class="pre">p</span></code> value is much less than <span class="math notranslate nohighlight">\(\alpha\)</span>, so we can reject the null hypothesis.</p>
<p>Note that this does not mean we can accept the alternative hypothesis. It only tells us that there is not enough evidence to reject <span class="math notranslate nohighlight">\(H_{a}\)</span>. In other words, we fail to reject the alternative hypothesis so, it <em>may</em> be true.</p>
</section>
<hr class="docutils" />
<section id="in-practice">
<h2>In practice…<a class="headerlink" href="#in-practice" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>The <a class="reference external" href="https://pandas.pydata.org/">pandas</a> library is preferable to use for time-series data analysis.</p></li>
<li><p>The SciPy stats module provides the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_rel.html">stats.ttest_rel</a> function which can be used to get the <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">statistic</span></code> and <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">value</span></code>.</p></li>
<li><p>In real life, data are generally not normally distributed. There are tests for such non-normal data like the <a class="reference external" href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test">Wilcoxon test</a>.</p></li>
</ul>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>There are a host of statistical tests you can choose according to the characteristics of the given data. Read more about them at
<a class="reference external" href="https://machinelearningmastery.com/statistical-data-distributions/">A Gentle Introduction to Statistical Data Distributions</a>.</p></li>
<li><p>There are various versions of the <a class="reference external" href="https://en.wikipedia.org/wiki/Student%27s_t-test">Student’s t-test</a> that you can adopt according to your needs.</p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="tutorial-plotting-fractals.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Plotting Fractals</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../contributing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Contributing</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By the NumPy community<br/>
  
      &copy; Copyright 2020, the NumPy community.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>